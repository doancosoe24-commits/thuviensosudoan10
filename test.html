<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trang chính</title>
<style>
body { font-family: Arial, sans-serif; margin:20px; background:#f7f9fb; }
h1 { color:#004aad; }
iframe { border:1px solid #ccc; border-radius:8px; width:100%; height:600px; }
.toast {position:fixed; top:-120px; left:50%; transform:translateX(-50%); padding:16px 28px; border-radius:12px; color:#fff; font-weight:700; opacity:0; transition:top 0.45s, opacity 0.45s; z-index:9999; font-size:14px;}
.toast.show {top:22px; opacity:1;}
.toast.success {background:#28a745;}
.toast.error {background:#dc3545;}
</style>
</head>
<body>

<h1>Trang chính</h1>
<iframe id="pdfFrame"></iframe>
<div id="toast" class="toast"></div>

<script>
const API = "https://script.google.com/macros/s/AKfycbxPWbbwdGjo3VrbBfzlzCcpGfqCQ7aNHLCsjkzTKdp7h7flB34JZKbsDGZ11l8si0PpHA/exec"; // Thay bằng URL Apps Script
const toastEl = document.getElementById("toast");

function showToast(msg,type="success",duration=4000){
    toastEl.textContent = msg;
    toastEl.className = `toast ${type} show`;
    setTimeout(()=>toastEl.className="toast", duration);
}

async function loadPDF(){
    const token = localStorage.getItem("jwt_token");
    if(!token){
        showToast("Vui lòng đăng nhập để xem nội dung","error");
        setTimeout(()=>window.location.href="login.html",1000);
        return;
    }

    try{
        const resp = await fetch(`${API}?route=data&token=${token}`);
        const data = await resp.json();
        if(data.status==="success"){
            // Ví dụ: lấy PDF đầu tiên từ sheet matkhauopen
            const pdfUrl = data.matkhauopen?.[0]?.Link || "";
            if(pdfUrl){
                document.getElementById("pdfFrame").src = pdfUrl;
            } else showToast("Chưa có PDF để hiển thị","error");
        } else{
            showToast("Phiên đăng nhập đã hết hạn. Vui lòng đăng nhập lại","error");
            localStorage.removeItem("jwt_token");
            setTimeout(()=>window.location.href="login.html",1500);
        }
    }catch(err){
        console.error(err);
        showToast("Lỗi kết nối server","error");
        localStorage.removeItem("jwt_token");
        setTimeout(()=>window.location.href="login.html",1500);
    }
}

loadPDF();
</script>

</body>
</html>
