<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="./img/logo.png" type="image/x-icon">
<title>Chi ti·∫øt vƒÉn b·∫£n</title>

<style>
:root{
  --primary:#004aad;
  --gold:#ccae6e;
  --bg:#f6f8fb;
  --card:#ffffff;
  --text:#1f2937;
  --radius:18px;
  --shadow:0 10px 28px rgba(0,0,0,0.08);
}

*{ box-sizing:border-box; }

html, body{
  height:100%;
  margin:0;
  font-family:"Segoe UI", Arial, sans-serif;
  background:var(--bg);
  color:var(--text);
}

body{
  display:flex;
  flex-direction:column;
  width:75%;
  margin:0 auto;
}

main{
  flex:1;
  padding:26px 0 40px;
}

/* ---------- BACK ---------- */
.back-link{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:8px 16px;
  border-radius:999px;
  background:#fff;
  box-shadow:var(--shadow);
  color:var(--primary);
  font-weight:600;
  cursor:pointer;
  transition:.25s;
  margin-bottom:18px;
}
.back-link:hover{
  background:var(--primary);
  color:#fff;
}

/* ---------- TITLE ---------- */
h2{
  text-align:center;
  color:var(--primary);
  font-size:22px;
  font-weight:800;
  letter-spacing:1px;
}

/* ---------- TABS ---------- */
.tabs-container{
  position:relative;
  display:flex;
  gap:12px;
  padding-bottom:12px;
  margin-bottom:18px;
  border-bottom:2px solid #e5e7eb;
}

.tab-btn{
  padding:10px 18px;
  border-radius:999px;
  font-size:14px;
  font-weight:700;
  background:#fff;
  color:var(--primary);
  cursor:pointer;
  box-shadow:var(--shadow);
  transition:.25s;
}

.tab-btn:hover{
  background:var(--primary);
  color:#fff;
}

.tab-btn.active{
  background:linear-gradient(135deg,var(--primary),#003a8c);
  color:var(--gold);
}

.tab-underline{
  display:none; /* gi·ªØ logic JS nh∆∞ng kh√¥ng c·∫ßn underline n·ªØa */
}

/* ---------- CONTENT CARD ---------- */
.tab-detail{
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:18px;
  min-height:520px;
  position:relative;
  overflow:hidden;
}

/* ---------- PDF BOX ---------- */
.pdf-box{
  position:relative;
  width:100%;
  height:720px;
  border-radius:14px;
  overflow:hidden;
  background:#fdfaf1;
  box-shadow:0 8px 20px rgba(0,0,0,0.12);
}

.pdf-box iframe{
  width:100%;
  height:100%;
  border:none;
}

/* ---------- EMPTY ---------- */
.empty-box{
  height:720px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  font-weight:600;
  color:#ff3131;
  background:#fff4e5;
  border-radius:14px;
}

/* ---------- WATERMARK ---------- */
.watermark{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:42px;
  font-weight:800;
  color:rgba(204,174,110,0.15);
  transform:rotate(-18deg);
  pointer-events:none;
  user-select:none;
}

/* ---------- RESPONSIVE ---------- */
@media(max-width:1024px){
  body{ width:90%; }
}

@media(max-width:768px){
  body{ width:100%; padding:0 }
  h2{ text-align:left; font-size:18px; text-align: center;}
  .pdf-box,.empty-box{ height:520px; }
}
</style>
</head>

<body>

<div id="header"></div>

<main>
  <span class="back-link" onclick="history.back()">‚Üê Quay l·∫°i</span>

  <h2 id="docTitle"></h2>

  <div class="tabs-container">
    <div class="tab-btn active" data-tab="source">üìÑ VƒÉn b·∫£n PDF</div>
    <div class="tab-underline"></div>
  </div>

  <div class="tab-detail" id="tabContent"></div>
</main>

<div id="footer"></div>

<script src="main.js"></script>
<script>
const webAppUrl = "https://script.google.com/macros/s/AKfycbxPWbbwdGjo3VrbBfzlzCcpGfqCQ7aNHLCsjkzTKdp7h7flB34JZKbsDGZ11l8si0PpHA/exec";
const slugFromURL = new URLSearchParams(window.location.search).get("slug");
const tabContent = document.getElementById("tabContent");
const docTitle = document.getElementById("docTitle");
const tabs = document.querySelectorAll(".tab-btn");
const underline = document.querySelector(".tab-underline");
let currentData = null;

// Bi·∫øn name th√†nh chu·ªói li·ªÅn, gi·ªØ D/ƒê, b·ªè d·∫•u, vi·∫øt hoa
function normalizeNameForComparison(name){
    return String(name || "")
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g,"") // b·ªè d·∫•u
        .replace(/[^a-zA-Z0-9ƒêƒë]/g,"") // ch·ªâ gi·ªØ ch·ªØ, s·ªë, D/ƒê li·ªÅn
        .toUpperCase();
}

// L·∫•y ID Google Drive t·ª´ link ƒë·∫ßy ƒë·ªß
function getDriveID(link){
    if(!link) return "";
    const match = link.match(/\/d\/([a-zA-Z0-9_-]+)/);
    return match ? match[1] : link; // n·∫øu ch·ªâ ID th√¨ d√πng lu√¥n
}

// underline animation
function updateUnderline(activeTab){
    if(!activeTab) return;
    underline.style.width = activeTab.offsetWidth + "px";
    underline.style.transform = `translateX(${activeTab.offsetLeft}px)`;
}
updateUnderline(document.querySelector(".tab-btn.active"));

// Hi·ªÉn th·ªã tab PDF
function showTab(data){
    if(!data) return;
    
    if(!data.url || data.url.trim() === ""){
        // N·∫øu URL r·ªóng
        tabContent.innerHTML = `
        <div style="position:relative; width:100%; height:700px; border-radius:10px; overflow:hidden; background:#fcf8e8; box-shadow:0 4px 12px rgba(0,0,0,0.1); display:flex; justify-content:center; align-items:center; font-size:18px; color:#ff3131;">
            D·ªØ li·ªáu PDF ch∆∞a c√≥
        </div>`;
    } else {
        const pdfID = getDriveID(data.url); // ho·∫∑c data.pdf_url t√πy sheet
        console.log("PDF ID:", pdfID);

        tabContent.innerHTML = `
        <div style="position:relative; width:100%; height:700px; border-radius:10px; overflow:hidden; background:#fcf8e8; box-shadow:0 4px 12px rgba(0,0,0,0.1);">
            <iframe src="https://drive.google.com/file/d/${pdfID}/preview" style="width:100%; height:100%; border:none;"></iframe>
            <div class="watermark">Th∆∞ vi·ªán s·ªë S∆∞ ƒëo√†n 10</div>
        </div>`;
    }

    docTitle.innerText = data.name || "Kh√¥ng c√≥ t√™n t√†i li·ªáu";
}

// Tab click
tabs.forEach(tab=>{
    tab.addEventListener("click", ()=>{
        const oldActive = document.querySelector(".tab-btn.active");
        if(oldActive) oldActive.classList.remove("active");
        tab.classList.add("active");
        showTab(currentData);
        updateUnderline(tab);
    });
});

// L·∫•y d·ªØ li·ªáu sheet TaiLieuNganh
if(slugFromURL){
    console.log("Slug t·ª´ URL:", slugFromURL);

    fetch(`${webAppUrl}?ref=${encodeURIComponent(window.location.origin)}`)
        .then(res=>res.json())
        .then(res=>{
            const rawList = res.data.TaiLieuNganh || [];
            console.log("Danh s√°ch TaiLieuNganh:", rawList);

            const matched = rawList.find(row => normalizeNameForComparison(row.name) === slugFromURL.toUpperCase());
            console.log("D·ªØ li·ªáu kh·ªõp:", matched);

            if(matched){
                currentData = matched;
                showTab(currentData);
            } else {
                docTitle.innerText = "Kh√¥ng t√¨m th·∫•y vƒÉn b·∫£n";
                tabContent.innerHTML = "<p>Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu.</p>";
            }
        })
        .catch(err=>{
            console.error("L·ªói t·∫£i d·ªØ li·ªáu:", err);
            docTitle.innerText = "L·ªói t·∫£i d·ªØ li·ªáu";
            tabContent.innerHTML = "<p>Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu.</p>";
        });
}else{
    docTitle.innerText = "Kh√¥ng x√°c ƒë·ªãnh vƒÉn b·∫£n";
    tabContent.innerHTML = "<p>Kh√¥ng c√≥ slug.</p>";
}


</script>

</body>
</html>
