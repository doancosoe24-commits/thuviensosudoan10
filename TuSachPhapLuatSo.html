<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Thư Viện Pháp Luật Số</title>
    <link rel="shortcut icon" href="./img/logo.png" type="image/x-icon">

<style>
:root{
  --primary:#004aad;
  --gold:#ccae6e;
  --bg:#f6f8fb;
  --card:#ffffff;
  --text:#1f2937;
  --muted:#6b7280;
  --radius:16px;
  --shadow:0 10px 25px rgba(0,0,0,0.08);
}

*{box-sizing:border-box}

html,body{
  margin:0;
  height:100%;
  font-family:"Segoe UI",Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
}

body{
  display:flex;
  flex-direction:column;
  width:75%;
  margin:0 auto;
}

main{
  flex:1;
  padding:28px 0 40px;
}

/* BACK */
.back-link{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:8px 14px;
  border-radius:999px;
  background:#fff;
  box-shadow:var(--shadow);
  color:var(--primary);
  font-weight:600;
  cursor:pointer;
  transition:.25s;
  margin-bottom:20px;
}
.back-link:hover{
  background:var(--primary);
  color:#fff;
}

/* TITLE */
#pageTitle{
  text-align:center;
  color:var(--primary);
  font-size:24px;
  font-weight:800;
  letter-spacing:1px;
  margin:10px 0 30px;
  text-transform:uppercase;
}

/* FILTER */
.filter-box{
  background:var(--card);
  padding:18px;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  display:flex;
  gap:14px;
  flex-wrap:wrap;
  margin-bottom:30px;
}

.filter-box select,
.filter-box button{
  padding:12px 16px;
  border-radius:10px;
  border:1px solid #d1d5db;
  font-size:14px;
  cursor:pointer;
  background:#fff;
}

.filter-box button{
  background:var(--primary);
  color:#fff;
  border:none;
  font-weight:700;
}
.filter-box button:hover{opacity:.9}

/* LIST */
#list{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
  gap:22px;
}

.item{
  background:linear-gradient(135deg,var(--primary),#003a8c);
  border-radius:var(--radius);
  padding:22px 18px;
  color:var(--gold);
  cursor:pointer;
  box-shadow:var(--shadow);
  transition:.3s;
}
.item:hover{
  transform:translateY(-6px) scale(1.02);
  color:#fff;
}

.item p{
  margin:0 0 12px;
  font-size:16px;
  font-weight:700;
  line-height:1.4;
}

.status{
  display:inline-block;
  padding:6px 14px;
  border-radius:999px;
  background:rgba(255,255,255,.2);
  color:#fff;
  font-size:12px;
  font-weight:700;
}

/* LOADING */
#loadingBox{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  padding:60px 0;
  color:var(--primary);
  font-weight:600;
}

.loader{
  width:52px;
  height:52px;
  border:4px solid rgba(0,0,0,.1);
  border-top-color:var(--gold);
  border-radius:50%;
  animation:spin .7s linear infinite;
  margin-bottom:14px;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* PAGINATION */
.pagination{
  text-align:center;
  margin-top:30px;
}
.pagination button{
  margin:0 4px;
  padding:7px 14px;
  border:none;
  border-radius:10px;
  cursor:pointer;
  background:var(--gold);
  color:#fff;
  font-weight:700;
}
.pagination button.active{background:var(--primary)}
.pagination button:hover{opacity:.85}

/* RESPONSIVE */
@media(max-width:1024px){ body{width:90%} }
@media(max-width:768px){
  body{width:100%}
  #pageTitle{font-size:20px}
  #list{grid-template-columns:1fr}
}
</style>
</head>

<body>
<div id="header"></div>
<main>
  <span class="back-link" onclick="history.back()">← Quay lại</span>
  <h2 id="pageTitle">TỦ SÁCH PHÁP LUẬT SỐ</h2>

  <div class="filter-box">
    <select id="filterCategory">
      <option value="">-- Loại văn bản --</option>
    </select>
    <select id="filterPublisher">
      <option value="">-- Cơ quan ban hành --</option>
    </select>
    <button id="btnAll">Hiển thị TẤT CẢ</button>
  </div>

  <div id="loadingBox">
    <div class="loader"></div>
    Đang tải dữ liệu...
  </div>

  <div id="list" style="display:none"></div>
  <div class="pagination" id="pagination"></div>
</main>
<div id="footer"></div>
<script src="main.js"></script>
<script>
/* ================== CONFIG ================== */
const webAppUrl = "https://script.google.com/macros/s/AKfycbxPWbbwdGjo3VrbBfzlzCcpGfqCQ7aNHLCsjkzTKdp7h7flB34JZKbsDGZ11l8si0PpHA/exec";
const ITEMS_PER_PAGE = 7;

/* ================== STATE ================== */
let ALL_DOCUMENTS = [];
let FILTERED = [];
let currentPage = 1;

/* ================== UTIL ================== */
function escapeHtml(str){
  return String(str || "")
    .replace(/&/g,"&amp;")
    .replace(/</g,"&lt;")
    .replace(/>/g,"&gt;")
    .replace(/"/g,"&quot;")
    .replace(/'/g,"&#39;");
}

function toSlug(text){
  return String(text || "")
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g,"")
    .replace(/[^a-zA-Z0-9\s]/g,"")
    .trim()
    .replace(/\s+/g,"-")
    .toLowerCase();
}

function showLoading(){
  document.getElementById("loadingBox").style.display = "flex";
}
function hideLoading(){
  document.getElementById("loadingBox").style.display = "none";
}

/* ================== LOAD ================== */
async function loadPage(){
  showLoading();
  try{
    const res = await fetch(webAppUrl).then(r=>r.json());
    ALL_DOCUMENTS = res?.data?.ThuVienPhapLuatSo || [];

    FILTERED = ALL_DOCUMENTS;
    loadFilterOptions(FILTERED);
    renderList(FILTERED);
    attachFilterEvents();

  }catch(err){
    console.error(err);
    document.getElementById("list").textContent = "Không thể tải dữ liệu.";
  }
  hideLoading();
}

/* ================== FILTER ================== */
function loadFilterOptions(data){
  const catSel = document.getElementById("filterCategory");
  const pubSel = document.getElementById("filterPublisher");

  [...new Set(data.map(i=>i.loaivanban).filter(Boolean))].forEach(v=>{
    const o=document.createElement("option");o.value=o.textContent=v;catSel.appendChild(o);
  });
  [...new Set(data.map(i=>i.noibanhanh).filter(Boolean))].forEach(v=>{
    const o=document.createElement("option");o.value=o.textContent=v;pubSel.appendChild(o);
  });
}

function attachFilterEvents(){
  document.getElementById("filterCategory").onchange=applyFilter;
  document.getElementById("filterPublisher").onchange=applyFilter;
  document.getElementById("btnAll").onclick=()=>{
    filterCategory.value="";
    filterPublisher.value="";
    renderList(FILTERED);
  };
}

function applyFilter(){
  const c=filterCategory.value;
  const p=filterPublisher.value;
  let r=FILTERED;
  if(c) r=r.filter(i=>i.loaivanban===c);
  if(p) r=r.filter(i=>i.noibanhanh===p);
  renderList(r);
}

/* ================== RENDER ================== */
function renderList(data){
  const list=document.getElementById("list");
  const pag=document.getElementById("pagination");
  list.innerHTML="";pag.innerHTML="";
  list.style.display="grid";

  if(!data.length){list.textContent="Không có văn bản.";return;}

  const total=Math.ceil(data.length/ITEMS_PER_PAGE);
  currentPage=Math.min(currentPage,total);

  const slice=data.slice((currentPage-1)*ITEMS_PER_PAGE,currentPage*ITEMS_PER_PAGE);

  slice.forEach(i=>{
    const d=document.createElement("div");
    d.className="item";
    d.dataset.slug=toSlug(i.title);
    d.innerHTML=`<p>${escapeHtml(i.title)}</p><span class="status">Có hiệu lực</span>`;
    list.appendChild(d);
  });

list.onclick = e => {
  const it = e.target.closest(".item");
  if (!it) return;

  location.href = `detail.html?slug=${it.dataset.slug}`;
};


  for(let p=1;p<=total;p++){
    const b=document.createElement("button");
    b.textContent=p;
    if(p===currentPage)b.classList.add("active");
    b.onclick=()=>{currentPage=p;renderList(data)};
    pag.appendChild(b);
  }
}

loadPage();
</script>

</body>
</html>
